<div class="user-tests-container">
  <!-- Error message -->
  @if (error()) {
    <div class="error-message">
      {{ error() }}
      <button (click)="error.set(null)">×</button>
    </div>
  }

  <!-- Loading -->
  @if (loading()) {
    <div class="loading">Yuklanmoqda...</div>
  }

  <!-- Test Result -->
  @if (result()) {
    <div class="result-card">
      <h2>Natija</h2>
      <div class="score">Ball: {{ result()!.score }}</div>
      <div class="result-text">{{ result()!.resultText }}</div>
      <div class="recommendation">
        <strong>Tavsiya:</strong> {{ result()!.recommendation }}
      </div>
      <button class="btn-primary" (click)="backToList()">Testlar ro'yxatiga qaytish</button>
    </div>
  }

  <!-- Test Questions -->
  @else if (selectedTest()) {
    <div class="test-detail">
      <button class="btn-back" (click)="backToList()">← Orqaga</button>
      <h2>{{ selectedTest()!.title }}</h2>
      <p class="description">{{ selectedTest()!.description }}</p>

      <div class="questions">
        @for (question of selectedTest()!.questions; track question.id; let i = $index) {
          <div class="question-card">
            <h3>{{ i + 1 }}. {{ question.text }}</h3>
            <div class="options">
              @for (option of question.options; track option.id) {
                <label
                  class="option"
                  [class.selected]="isOptionSelected(question.id, option.id)"
                  (click)="selectOption(question.id, option.id)">
                  <input
                    type="radio"
                    [name]="question.id"
                    [value]="option.id"
                    [checked]="isOptionSelected(question.id, option.id)">
                  {{ option.text }}
                </label>
              }
            </div>
          </div>
        }
      </div>

      <button
        class="btn-submit"
        [disabled]="!canSubmit() || submitting()"
        (click)="submitTest()">
        @if (submitting()) {
          Topshirilmoqda...
        } @else {
          Testni topshirish
        }
      </button>
    </div>
  }

  <!-- Tests List -->
  @else if (!loading()) {
    <div class="tests-list">
      <h2>Diagnostik Testlar</h2>
      @if (tests().length === 0) {
        <p class="no-tests">Hozircha testlar mavjud emas</p>
      } @else {
        <div class="tests-grid">
          @for (test of tests(); track test.id) {
            <div class="test-card" (click)="selectTest(test.slug)">
              <h3>{{ test.title }}</h3>
              <p>{{ test.description }}</p>
              <button class="btn-start">Testni boshlash</button>
            </div>
          }
        </div>
      }
    </div>
  }
</div>
