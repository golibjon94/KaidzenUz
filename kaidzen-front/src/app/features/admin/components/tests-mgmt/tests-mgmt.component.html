<div class="p-6 max-w-7xl mx-auto">

  <div class="flex items-center justify-between mb-6 bg-white p-4 rounded-xl shadow-sm border border-gray-100">
    <div>
      <h1 class="text-2xl font-bold text-gray-800 m-0">Testlar Boshqaruvi</h1>
      <p class="text-gray-500 text-sm">Tizimdagi barcha testlarni boshqarish</p>
    </div>
    <button mat-raised-button color="primary" (click)="addTest()" class="rounded-lg flex items-center gap-2">
      <mat-icon>add</mat-icon>
      <span>Yangi test yaratish</span>
    </button>
  </div>

  <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
    @if (loading()) {
      <div class="flex justify-center items-center py-20">
        <mat-spinner diameter="50"></mat-spinner>
      </div>
    } @else {
      <table mat-table [dataSource]="tests()" class="w-full">
        <!-- Test nomi -->
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef class="w-[300px]">Test nomi</th>
          <td mat-cell *matCellDef="let data">
            <div class="font-semibold text-gray-800">{{ data.title }}</div>
            <div class="text-xs text-gray-400 truncate max-w-xs">{{ data.description }}</div>
          </td>
        </ng-container>

        <!-- Slug -->
        <ng-container matColumnDef="slug">
          <th mat-header-cell *matHeaderCellDef>Slug</th>
          <td mat-cell *matCellDef="let data">
            <code class="text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded">{{ data.slug }}</code>
          </td>
        </ng-container>

        <!-- Savollar -->
        <ng-container matColumnDef="questions">
          <th mat-header-cell *matHeaderCellDef>Savollar</th>
          <td mat-cell *matCellDef="let data">
            <mat-chip class="bg-blue-100 text-blue-800">{{ data._count?.questions || 0 }} ta savol</mat-chip>
          </td>
        </ng-container>

        <!-- Holati -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Holati</th>
          <td mat-cell *matCellDef="let data">
            <span class="inline-flex items-center gap-2">
              <span class="w-2 h-2 rounded-full" [class.bg-green-500]="data.isActive" [class.bg-gray-400]="!data.isActive"></span>
              <span>{{ data.isActive ? 'Faol' : 'Nofaol' }}</span>
            </span>
          </td>
        </ng-container>

        <!-- Amallar -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="text-right">Amallar</th>
          <td mat-cell *matCellDef="let data" class="text-right">
            <div class="flex gap-2 justify-end">
              <button
                mat-icon-button
                (click)="editTest(data.id)"
                class="text-blue-500"
                matTooltip="Tahrirlash"
                aria-label="Tahrirlash"
              >
                <mat-icon>edit</mat-icon>
              </button>

              <button
                mat-icon-button
                color="warn"
                (click)="confirmDelete(data.id)"
                matTooltip="O'chirish"
                aria-label="O'chirish"
              >
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-gray-50 transition-colors"></tr>
      </table>

      <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
    }
  </div>
</div>
