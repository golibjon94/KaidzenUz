<div class="p-6">
  <!-- Header -->
  <div class="flex items-center justify-between mb-4">
    <div class="flex items-center gap-3">
      <button mat-icon-button (click)="cancel()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div>
        <h2 class="text-lg font-semibold text-gray-800">
          {{ isEdit() ? 'Maqolani tahrirlash' : 'Yangi maqola' }}
        </h2>
        <p class="text-sm text-gray-400">Sarlavha, kontent va rasmni kiriting</p>
      </div>
    </div>

    <div class="flex items-center gap-2">
      <button mat-button (click)="cancel()" [disabled]="saving()">Bekor qilish</button>
      <button mat-flat-button color="primary" (click)="save()" [disabled]="saving()">
        @if (saving()) {
          <mat-spinner diameter="18" class="inline-block mr-2"></mat-spinner>
        }
        <mat-icon>save</mat-icon>
        {{ isEdit() ? 'Yangilash' : 'Saqlash' }}
      </button>
    </div>
  </div>

  <!-- Loading -->
  @if (loading()) {
    <div class="flex justify-center py-16">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  } @else {
    <form [formGroup]="form">

      <!-- Row 1: Title + Slug -->
      <div class="form-row">
        <mat-form-field appearance="outline" class="flex-1">
          <mat-label>Sarlavha</mat-label>
          <input matInput formControlName="title" placeholder="Maqola sarlavhasi">
          <mat-icon matPrefix>title</mat-icon>
          <mat-hint>Slug avtomatik hosil bo'ladi</mat-hint>
          <mat-error>Sarlavhani kiriting</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="flex-1">
          <mat-label>Slug (Havola nomi)</mat-label>
          <input matInput formControlName="slug" placeholder="maqola-manzili">
          <mat-icon matPrefix>link</mat-icon>
          <mat-hint matTooltip="Slug - bu sahifaning URL manzili uchun ishlatiladigan qisqa nom. Masalan: maqola-nomi">
            /blog/{{ form.get('slug')?.value || 'slug' }}
            <mat-icon class="!text-[10px] text-gray-400 align-middle">info</mat-icon>
          </mat-hint>
          <mat-error>Slugni kiriting</mat-error>
        </mat-form-field>
      </div>

      <!-- Row 2: Image + Status -->
      <div class="form-row items-start">
        <!-- Image upload -->
        <div class="flex-1">
          <label class="field-label">Rasm</label>
          <div class="image-upload-area">
            @if (imagePreviewUrl()) {
              <div class="image-preview">
                <img [src]="imagePreviewUrl()!" alt="">
                <div class="image-overlay">
                  <button mat-icon-button (click)="removeImage()" class="!text-white">
                    <mat-icon>close</mat-icon>
                  </button>
                </div>
              </div>
              <input type="file" accept="image/*" (change)="onFileSelected($event)"
                     class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
            } @else {
              <label class="image-placeholder">
                <mat-icon class="!text-3xl text-gray-300">add_photo_alternate</mat-icon>
                <span class="text-xs text-gray-400 mt-1">Rasm yuklash</span>
                <span class="text-xs text-gray-300">1200Ã—630 tavsiya</span>
                <input type="file" accept="image/*" (change)="onFileSelected($event)" class="hidden">
              </label>
            }
          </div>
          <input type="hidden" formControlName="imageId">
        </div>

        <!-- Status -->
        <mat-form-field appearance="outline" class="flex-1">
          <mat-label>Status</mat-label>
          <mat-select formControlName="status">
            <mat-option [value]="blogStatus.DRAFT">
              <div class="flex items-center gap-2">
                <span class="status-dot draft"></span> Qoralama
              </div>
            </mat-option>
            <mat-option [value]="blogStatus.PUBLISHED">
              <div class="flex items-center gap-2">
                <span class="status-dot published"></span> Chop etilgan
              </div>
            </mat-option>
            <mat-option [value]="blogStatus.ARCHIVED">
              <div class="flex items-center gap-2">
                <span class="status-dot archived"></span> Arxivlangan
              </div>
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- Row 3: Quill Editor -->
      <div class="editor-section">
        <label class="field-label">Kontent</label>
        <quill-editor
          formControlName="content"
          [modules]="quillModules"
          [styles]="{ height: '380px' }"
          placeholder="Maqolani yozishni boshlang..."
        ></quill-editor>
        @if (form.get('content')?.invalid && form.get('content')?.touched) {
          <div class="text-xs text-red-500 mt-1">Kontentni kiriting</div>
        }
      </div>
    </form>
  }
</div>
